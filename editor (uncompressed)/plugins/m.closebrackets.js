!function(e){function t(e,t){return"pairs"==t&&"string"==typeof e?e:"object"==typeof e&&null!=e[t]?e[t]:f[t]}function n(e){for(var t=0;t<e.length;t++){var n=e.charAt(t),i="'"+n+"'";g[i]||(g[i]=r(n))}}function r(e){return function(t){return s(t,e)}}function i(e){var t=e.state.closeBrackets;return!t||t.override?t:e.getModeAt(e.getCursor()).closeBrackets||t}function a(t){var n=e.cmpPos(t.anchor,t.head)>0;return{anchor:new u(t.anchor.line,t.anchor.ch+(n?-1:1)),head:new u(t.head.line,t.head.ch+(n?1:-1))}}function s(n,r){var s=i(n);if(!s||n.getOption("disableInput"))return e.Pass;var l=t(s,"pairs"),f=l.indexOf(r);if(-1==f)return e.Pass;for(var g,p=t(s,"triples"),d=l.charAt(f+1)==r,v=n.listSelections(),m=f%2==0,b=0;b<v.length;b++){var S,k=v[b],x=k.head,C=n.getRange(x,u(x.line,x.ch+1));if(m&&!k.empty())S="surround";else if(!d&&m||C!=r)if(d&&x.ch>1&&p.indexOf(r)>=0&&n.getRange(u(x.line,x.ch-2),x)==r+r&&(x.ch<=2||n.getRange(u(x.line,x.ch-3),u(x.line,x.ch-2))!=r))S="addFour";else if(d){if(e.isWordChar(C)||!c(n,x,r))return e.Pass;S="both"}else{if(!m||n.getLine(x.line).length!=x.ch&&!o(C,l)&&!/\s/.test(C))return e.Pass;S="both"}else S=d&&h(n,x)?"both":p.indexOf(r)>=0&&n.getRange(x,u(x.line,x.ch+3))==r+r+r?"skipThree":"skip";if(g){if(g!=S)return e.Pass}else g=S}var P=f%2?l.charAt(f-1):r,O=f%2?r:l.charAt(f+1);n.operation(function(){if("skip"==g)n.execCommand("goCharRight");else if("skipThree"==g)for(t=0;t<3;t++)n.execCommand("goCharRight");else if("surround"==g){for(var e=n.getSelections(),t=0;t<e.length;t++)e[t]=P+e[t]+O;n.replaceSelections(e,"around"),e=n.listSelections().slice();for(t=0;t<e.length;t++)e[t]=a(e[t]);n.setSelections(e)}else"both"==g?(n.replaceSelection(P+O,null),n.triggerElectric(P+O),n.execCommand("goCharLeft")):"addFour"==g&&(n.replaceSelection(P+P+P+P,"before"),n.execCommand("goCharRight"))})}function o(e,t){var n=t.lastIndexOf(e);return n>-1&&n%2==1}function l(e,t){var n=e.getRange(u(t.line,t.ch-1),u(t.line,t.ch+1));return 2==n.length?n:null}function c(t,n,r){var i=t.getLine(n.line),a=t.getTokenAt(n);if(/\bstring2?\b/.test(a.type)||h(t,n))return!1;var s=new e.StringStream(i.slice(0,n.ch)+r+i.slice(n.ch),4);for(s.pos=s.start=a.start;;){var o=t.getMode().token(s,a.state);if(s.pos>=n.ch+1)return/\bstring2?\b/.test(o);s.start=s.pos}}function h(e,t){var n=e.getTokenAt(u(t.line,t.ch+1));return/\bstring/.test(n.type)&&n.start==t.ch}var f={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},u=e.Pos;e.defineOption("autoCloseBrackets",!1,function(r,i,a){a&&a!=e.Init&&(r.removeKeyMap(g),r.state.closeBrackets=null),i&&(n(t(i,"pairs")),r.state.closeBrackets=i,r.addKeyMap(g))});var g={Backspace:function(n){var r=i(n);if(!r||n.getOption("disableInput"))return e.Pass;for(var a=t(r,"pairs"),s=n.listSelections(),o=0;o<s.length;o++){if(!s[o].empty())return e.Pass;var c=l(n,s[o].head);if(!c||a.indexOf(c)%2!=0)return e.Pass}for(o=s.length-1;o>=0;o--){var h=s[o].head;n.replaceRange("",u(h.line,h.ch-1),u(h.line,h.ch+1),"+delete")}},Enter:function(n){var r=i(n),a=r&&t(r,"explode");if(!a||n.getOption("disableInput"))return e.Pass;for(var s=n.listSelections(),o=0;o<s.length;o++){if(!s[o].empty())return e.Pass;var c=l(n,s[o].head);if(!c||a.indexOf(c)%2!=0)return e.Pass}n.operation(function(){var e=n.lineSeparator()||"\n";n.replaceSelection(e+e,null),n.execCommand("goCharLeft"),s=n.listSelections();for(var t=0;t<s.length;t++){var r=s[t].head.line;n.indentLine(r,null,!0),n.indentLine(r+1,null,!0)}})}};n(f.pairs+"`")}(CodeMirror);
