!function(e){function t(t){if(t.getOption("disableInput"))return e.Pass;for(var n=t.listSelections(),a=[],l=0;l<n.length;l++){if(!n[l].empty())return e.Pass;var g=n[l].head,c=t.getTokenAt(g),d=e.innerMode(t.getMode(),c.state),f=d.state;if("xml"!=d.mode.name||!f.tagName)return e.Pass;var u=t.getOption("autoCloseTags"),h="html"==d.mode.configuration,m="object"==typeof u&&u.dontCloseTags||h&&i,p="object"==typeof u&&u.indentTags||h&&s,v=f.tagName;c.end>g.ch&&(v=v.slice(0,v.length-c.end+g.ch));var y=v.toLowerCase();if(!v||"string"==c.type&&(c.end!=g.ch||!/[\"\']/.test(c.string.charAt(c.string.length-1))||1==c.string.length)||"tag"==c.type&&"closeTag"==f.type||c.string.indexOf("/")==c.string.length-1||m&&r(m,y)>-1||o(t,v,g,f,!0))return e.Pass;var P=p&&r(p,y)>-1;a[l]={indent:P,text:">"+(P?"\n\n":"")+"</"+v+">",newPos:P?e.Pos(g.line+1,0):e.Pos(g.line,g.ch+1)}}for(l=n.length-1;l>=0;l--){var b=a[l];t.replaceRange(b.text,n[l].head,n[l].anchor,"+insert");var x=t.listSelections().slice(0);x[l]={head:b.newPos,anchor:b.newPos},t.setSelections(x),b.indent&&(t.indentLine(b.newPos.line,null,!0),t.indentLine(b.newPos.line+1,null,!0))}}function n(t,n){for(var a=t.listSelections(),r=[],i=n?"/":"</",s=0;s<a.length;s++){if(!a[s].empty())return e.Pass;var l=a[s].head,g=t.getTokenAt(l),c=e.innerMode(t.getMode(),g.state),d=c.state;if(n&&("string"==g.type||"<"!=g.string.charAt(0)||g.start!=l.ch-1))return e.Pass;var f;if("xml"!=c.mode.name)if("htmlmixed"==t.getMode().name&&"javascript"==c.mode.name)f=i+"script";else{if("htmlmixed"!=t.getMode().name||"css"!=c.mode.name)return e.Pass;f=i+"style"}else{if(!d.context||!d.context.tagName||o(t,d.context.tagName,l,d))return e.Pass;f=i+d.context.tagName}">"!=t.getLine(l.line).charAt(g.end)&&(f+=">"),r[s]=f}t.replaceSelections(r),a=t.listSelections();for(s=0;s<a.length;s++)(s==a.length-1||a[s].head.line<a[s+1].head.line)&&t.indentLine(a[s].head.line)}function a(t){return t.getOption("disableInput")?e.Pass:n(t,!0)}function r(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,a=e.length;n<a;++n)if(e[n]==t)return n;return-1}function o(t,n,a,r,o){if(!e.scanForClosingTag)return!1;var i=Math.min(t.lastLine()+1,a.line+500),s=e.scanForClosingTag(t,a,null,i);if(!s||s.tag!=n)return!1;for(var l=r.context,g=o?1:0;l&&l.tagName==n;l=l.prev)++g;a=s.to;for(var c=1;c<g;c++){var d=e.scanForClosingTag(t,a,null,i);if(!d||d.tag!=n)return!1;a=d.to}return!0}e.defineOption("autoCloseTags",!1,function(n,r,o){if(o!=e.Init&&o&&n.removeKeyMap("autoCloseTags"),r){var i={name:"autoCloseTags"};("object"!=typeof r||r.whenClosing)&&(i["'/'"]=function(e){return a(e)}),("object"!=typeof r||r.whenOpening)&&(i["'>'"]=function(e){return t(e)}),n.addKeyMap(i)}});var i=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],s=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];e.commands.smartCloseTag=function(e){return t(e)};e.commands.closeTag=function(e){return n(e)}}(CodeMirror);
